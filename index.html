<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏÑúÎπÑÏä§ Ï†ëÏàò ÎåÄÏãúÎ≥¥Îìú</title>
    
    <!-- pako ÎùºÏù¥Î∏åÎü¨Î¶¨ (Îç∞Ïù¥ÌÑ∞ ÏïïÏ∂ï Ìï¥Ï†úÏö©) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    
    <!-- 
    ====================================================================
    Î¶¨Ìå©ÌÜ†ÎßÅ Î≤ÑÏ†Ñ - Ïô∏Î∂Ä JSON Îç∞Ïù¥ÌÑ∞ Î°úÎî©
    ====================================================================
    ÌååÏùº Íµ¨Ï°∞:
    üìÅ dashboard/
      ‚îú‚îÄ‚îÄ index.html          (Ïù¥ ÌååÏùº)
      ‚îú‚îÄ‚îÄ chart.umd.js        (Chart.js ÎùºÏù¥Î∏åÎü¨Î¶¨)
      ‚îú‚îÄ‚îÄ manifest.json        (Îç∞Ïù¥ÌÑ∞ Î™©Î°ù)
      ‚îî‚îÄ‚îÄ üìÅ data/
          ‚îú‚îÄ‚îÄ 2026-01.json     (ÏõîÎ≥Ñ Îç∞Ïù¥ÌÑ∞)
          ‚îú‚îÄ‚îÄ 2026-02.json
          ‚îî‚îÄ‚îÄ ...
    
    Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ Î∞©Î≤ï:
      python convert_excel_to_json.py ÌååÏùº.xlsx 2026-02
    ====================================================================
    -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", "ÎßëÏùÄ Í≥†Îîï", "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        .main-nav {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid #F1F5F9;
        }
        .nav-button {
            padding: 14px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            border: 2px solid #667EEA;
            background: white;
            color: #667EEA;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .nav-button:hover {
            background: #667EEA;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        .nav-button.active {
            background: #667EEA;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        h1 {
            font-size: 36px;
            font-weight: 800;
            color: #667EEA;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #64748B;
            font-size: 15px;
            margin-bottom: 24px;
        }

        /* ===== Í∏∞Í∞Ñ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ ===== */
        .period-selector-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
            border-radius: 12px;
            border: 2px solid #C7D2FE;
        }
        .period-selector-label {
            font-size: 14px;
            font-weight: 700;
            color: #4338CA;
        }
        .period-selector {
            padding: 10px 36px 10px 16px;
            border-radius: 8px;
            border: 2px solid #A5B4FC;
            background: white;
            font-size: 15px;
            font-weight: 600;
            color: #1E293B;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%234338CA' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            transition: all 0.2s;
        }
        .period-selector:hover {
            border-color: #667EEA;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .period-selector:focus {
            outline: none;
            border-color: #667EEA;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }
        .period-info {
            font-size: 13px;
            color: #6366F1;
            font-weight: 500;
        }

        /* ===== Î°úÎî© ÏÉÅÌÉú ===== */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 16px;
        }
        .loading-overlay.show { display: flex; }
        .loading-spinner {
            width: 48px; height: 48px;
            border: 4px solid #E2E8F0;
            border-top-color: #667EEA;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text {
            font-size: 16px;
            font-weight: 600;
            color: #667EEA;
        }

        /* ===== ÏóêÎü¨ ÏÉÅÌÉú ===== */
        .error-banner {
            display: none;
            padding: 16px 24px;
            background: #FEF2F2;
            border: 2px solid #FCA5A5;
            border-radius: 12px;
            margin-bottom: 24px;
            color: #991B1B;
            font-size: 14px;
            font-weight: 600;
        }
        .error-banner.show { display: block; }

        /* Î°úÏª¨ ÌååÏùº ÏßÅÏ†ë Î°úÎî© Ìå®ÎÑê */
        .file-fallback {
            display: none;
            padding: 24px;
            background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%);
            border: 2px solid #F59E0B;
            border-radius: 16px;
            margin-bottom: 24px;
        }
        .file-fallback.show { display: block; }
        .file-fallback h3 {
            font-size: 16px; font-weight: 700; color: #92400E; margin-bottom: 8px;
        }
        .file-fallback p {
            font-size: 13px; color: #78350F; margin-bottom: 16px; line-height: 1.6;
        }
        .file-fallback .fb-row {
            display: flex; align-items: center; gap: 12px; margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .file-fallback .fb-label {
            font-size: 13px; font-weight: 700; color: #92400E; min-width: 120px;
        }
        .file-fallback .fb-btn {
            padding: 8px 20px; border-radius: 8px; border: 2px solid #D97706;
            background: white; color: #92400E; font-weight: 600; font-size: 13px;
            cursor: pointer; font-family: inherit; transition: all 0.2s;
        }
        .file-fallback .fb-btn:hover { background: #FEF3C7; }
        .file-fallback .fb-btn.loaded {
            background: #D1FAE5; border-color: #059669; color: #065F46;
        }
        .file-fallback .fb-status {
            font-size: 12px; color: #059669; font-weight: 600;
        }
        .file-fallback input[type="file"] { display: none; }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 28px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: #F1F5F9;
            color: #64748B;
            transition: all 0.3s;
        }
        .tab.active {
            background: #667EEA;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            border-radius: 16px;
            padding: 24px;
            border: 2px solid;
        }
        .stat-label {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 12px;
        }
        .stat-badge {
            font-size: 13px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 8px;
            display: inline-block;
        }
        .filters-container {
            position: sticky;
            top: 20px;
            z-index: 100;
            margin-bottom: 32px;
        }
        .filters {
            background: #F8FAFC;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s;
        }
        .filters.scrolled {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }
        .filter-label {
            font-size: 14px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 12px;
        }
        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid #E2E8F0;
            background: white;
            color: #64748B;
            transition: all 0.2s;
        }
        .filter-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            border-color: #CBD5E1;
        }
        .filter-btn.active {
            color: white !important;
            border-color: transparent;
        }
        .filter-btn.active[data-type="center1"] {
            background: #EC4899;
        }
        .filter-btn.active[data-type="center2"] {
            background: #667EEA;
        }
        .filter-btn.active[data-type="payment"] {
            background: #10B981;
        }
        .chart-container {
            background: #F8FAFC;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
        }
        .chart-title {
            font-size: 20px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 8px;
        }
        .chart-description {
            font-size: 13px;
            color: #64748B;
            margin-bottom: 24px;
        }
        .chart-wrapper {
            position: relative;
            height: 450px;
        }
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }
        .chart-small {
            background: #F8FAFC;
            border-radius: 16px;
            padding: 24px;
        }
        .chart-small .chart-wrapper {
            height: 350px;
        }
        .detail-cards {
            margin-top: 32px;
        }
        .detail-cards-title {
            font-size: 20px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 8px;
        }
        .detail-cards-subtitle {
            font-size: 13px;
            color: #64748B;
            margin-bottom: 20px;
        }
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }
        .detail-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid;
            position: relative;
        }
        .detail-card.increase {
            border-color: #10B981;
            background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
        }
        .detail-card.decrease {
            border-color: #EF4444;
            background: linear-gradient(135deg, #FEF2F2 0%, #FEE2E2 100%);
        }
        .card-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        .card-badge.increase {
            background: #10B981;
            color: white;
        }
        .card-badge.decrease {
            background: #EF4444;
            color: white;
        }
        .card-name {
            font-size: 16px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 12px;
            padding-right: 60px;
        }
        .card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .card-row-label {
            font-size: 12px;
            color: #64748B;
        }
        .card-row-value {
            font-size: 14px;
            font-weight: 700;
        }
        .card-change {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 16px;
            font-weight: 800;
        }
        .card-change.increase {
            background: #10B981;
            color: white;
        }
        .card-change.decrease {
            background: #EF4444;
            color: white;
        }
        .fault-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 2px dashed rgba(0,0,0,0.1);
        }
        .fault-title {
            font-size: 13px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 8px;
        }
        .fault-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 12px;
        }
        .fault-name {
            color: #475569;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
        }
        .fault-count {
            font-weight: 700;
            color: #1E293B;
            margin-right: 8px;
        }
        .fault-percentage {
            font-size: 11px;
            color: #64748B;
            background: rgba(0,0,0,0.05);
            padding: 2px 8px;
            border-radius: 12px;
        }
        /* ÎØ∏Ï≤òÎ¶¨ ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
        .unprocessed-section {
            margin-top: 32px;
            background: #FEF2F2;
            border-radius: 16px;
            padding: 28px;
            border: 2px solid #FCA5A5;
        }
        .unprocessed-title {
            font-size: 20px;
            font-weight: 700;
            color: #991B1B;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .unprocessed-subtitle {
            font-size: 13px;
            color: #B91C1C;
            margin-bottom: 20px;
        }
        .unprocessed-table {
            width: 100%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #FCA5A5;
        }
        .unprocessed-table thead {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
        }
        .unprocessed-table th {
            padding: 16px;
            text-align: left;
            font-size: 13px;
            font-weight: 700;
            color: #991B1B;
            border-bottom: 2px solid #FCA5A5;
        }
        .unprocessed-table td {
            padding: 14px 16px;
            font-size: 14px;
            color: #1E293B;
            border-bottom: 1px solid #FEE2E2;
        }
        .unprocessed-table tbody tr:hover {
            background: #FEF2F2;
        }
        .unprocessed-table tbody tr:last-child td {
            border-bottom: none;
        }
        .center-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        .center-type-badge.install {
            background: #E0E7FF;
            color: #4C1D95;
        }
        .center-type-badge.store {
            background: #FCE7F3;
            color: #831843;
        }
        .unprocessed-count {
            font-weight: 700;
            color: #DC2626;
        }
        .unprocessed-rate {
            font-weight: 700;
            color: #DC2626;
        }
        .analysis-item-details {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px dashed rgba(0,0,0,0.1);
        }
        .analysis-item-details.show {
            display: block;
        }
        .analysis-detail-title {
            font-size: 12px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 8px;
        }
        .analysis-fault-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            margin-bottom: 4px;
            background: white;
            border-radius: 6px;
            font-size: 11px;
        }
        .analysis-fault-name {
            flex: 1;
            color: #475569;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
        }
        .analysis-fault-count {
            font-weight: 700;
            color: #1E293B;
            margin-right: 6px;
        }
        .analysis-fault-percentage {
            font-size: 10px;
            color: #64748B;
            background: rgba(0,0,0,0.05);
            padding: 2px 6px;
            border-radius: 8px;
        }

        /* Î∂ÑÏÑù ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .analysis-section {
            margin-top: 32px;
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-radius: 16px;
            padding: 28px;
            border: 2px solid #FCD34D;
        }
        .analysis-title {
            font-size: 20px;
            font-weight: 700;
            color: #78350F;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .analysis-subtitle {
            font-size: 13px;
            color: #92400E;
            margin-bottom: 20px;
        }
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .analysis-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid;
        }
        .analysis-box.increase {
            border-color: #10B981;
        }
        .analysis-box.decrease {
            border-color: #EF4444;
        }
        .analysis-box-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .analysis-box.increase .analysis-box-title {
            color: #10B981;
        }
        .analysis-box.decrease .analysis-box-title {
            color: #EF4444;
        }
        .analysis-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: #F8FAFC;
            border-left: 4px solid;
            cursor: pointer;
            transition: all 0.3s;
        }
        .analysis-item:hover {
            background: #E2E8F0;
            transform: translateX(4px);
        }
        .analysis-item.active {
            background: #E0E7FF;
        }
        .analysis-item.increase {
            border-left-color: #10B981;
        }
        .analysis-item.decrease {
            border-left-color: #EF4444;
        }
        .analysis-item-header {
            font-size: 14px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 4px;
        }
        .analysis-item-detail {
            font-size: 12px;
            color: #64748B;
        }
        .analysis-item-change {
            font-size: 13px;
            font-weight: 700;
            margin-top: 6px;
        }
        .analysis-item-change.increase {
            color: #10B981;
        }
        .analysis-item-change.decrease {
            color: #EF4444;
        }

        /* Í∞úÏÑ†Îêú Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .product-cards-container {
            margin-top: 30px;
            padding: 25px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .product-cards-title {
            font-size: 20px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 8px;
        }
        .product-cards-subtitle {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 25px;
        }
        .product-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
        }
        .product-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #E5E7EB;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .product-card.increase { border-color: #10B981; }
        .product-card.decrease { border-color: #EF4444; }
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .product-card-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
        }
        .product-card-badge.increase { background: #D1FAE5; color: #065F46; }
        .product-card-badge.decrease { background: #FEE2E2; color: #991B1B; }
        .product-card-name {
            font-size: 16px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 16px;
            padding-right: 60px;
            line-height: 1.4;
        }
        .product-card-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 13px;
        }
        .product-card-stat-label { color: #6B7280; font-weight: 500; }
        .product-card-stat-value { font-weight: 700; color: #1F2937; }
        .product-card-stat-value.orange { color: #F59E0B; }
        .product-card-stat-value.blue { color: #3B82F6; }
        .product-card-change-box {
            margin-top: 16px;
            padding: 14px;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            font-size: 18px;
        }
        .product-card-change-box.increase { background: #D1FAE5; color: #065F46; }
        .product-card-change-box.decrease { background: #FEE2E2; color: #991B1B; }
        .product-card-change-label {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .container { padding: 20px; }
            .charts-row { grid-template-columns: 1fr; }
            .filter-group { grid-template-columns: 1fr; }
            .filters-container { top: 10px; }
            .analysis-grid { grid-template-columns: 1fr; }
            .unprocessed-table { font-size: 12px; }
            .unprocessed-table th, .unprocessed-table td { padding: 10px 8px; }
        }
    </style>
</head>
<body>
    <!-- Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
    </div>

    <div class="container">
        <!-- Î©îÏù∏ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <div class="main-nav">
            <a href="index.html" class="nav-button active">üìä ÏÑúÎπÑÏä§ Ï†ëÏàò ÎπÑÍµê Î∂ÑÏÑù</a>
            <a href="symptom_analysis.html" class="nav-button">üîç Î¨∏ÏùòÎÇ¥Ïö© Ï¶ùÏÉÅ Î∂ÑÏÑù</a>
            <a href="processing_dashboard.html" class="nav-button">üìã Ï≤òÎ¶¨Í±¥ Î∂ÑÏÑù</a>
        </div>
        
        <h1>ÏÑúÎπÑÏä§ Ï†ëÏàò - Ï†úÌíàÎ≥Ñ, ÏÑºÌÑ∞Î≥Ñ ÌòÑÌô©</h1>
        <p class="subtitle" id="subtitleText">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</p>

        <!-- üÜï Í∏∞Í∞Ñ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ -->
        <div class="period-selector-container">
            <span class="period-selector-label">üìÖ Î∂ÑÏÑù Í∏∞Í∞Ñ:</span>
            <select class="period-selector" id="periodSelector">
                <option value="">Î°úÎî© Ï§ë...</option>
            </select>
            <span class="period-info" id="periodInfo"></span>
        </div>

        <!-- ÏóêÎü¨ Î∞∞ÎÑà -->
        <div class="error-banner" id="errorBanner"></div>

        <!-- üÜï Î°úÏª¨ ÌååÏùº ÏßÅÏ†ë Î°úÎî© Ìå®ÎÑê (file:// ÌîÑÎ°úÌÜ†ÏΩúÏö©) -->
        <div class="file-fallback" id="fileFallback">
            <h3>üìÅ Î°úÏª¨ ÌååÏùº Î™®Îìú</h3>
            <p>Î°úÏª¨(file://)ÏóêÏÑúÎäî ÏûêÎèô Î°úÎî©Ïù¥ Î∂àÍ∞ÄÌï©ÎãàÎã§. ÏïÑÎûò Î≤ÑÌäºÏúºÎ°ú JSON ÌååÏùºÏùÑ ÏßÅÏ†ë ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.<br>
            ÎòêÎäî Î°úÏª¨ ÏÑúÎ≤ÑÎ•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî: <code style="background:#FEF3C7;padding:2px 6px;border-radius:4px;font-size:12px;">python -m http.server 8000</code> ‚Üí <code style="background:#FEF3C7;padding:2px 6px;border-radius:4px;font-size:12px;">http://localhost:8000</code></p>
            <div class="fb-row">
                <span class="fb-label">‚ë† manifest.json</span>
                <button class="fb-btn" id="fbManifestBtn" onclick="document.getElementById('fbManifestInput').click()">ÌååÏùº ÏÑ†ÌÉù</button>
                <span class="fb-status" id="fbManifestStatus"></span>
                <input type="file" id="fbManifestInput" accept=".json" onchange="handleLocalManifest(this)">
            </div>
            <div class="fb-row" id="fbDataRow" style="display:none;">
                <span class="fb-label">‚ë° Îç∞Ïù¥ÌÑ∞ JSON</span>
                <button class="fb-btn" id="fbDataBtn" onclick="document.getElementById('fbDataInput').click()">ÌååÏùº ÏÑ†ÌÉù</button>
                <span class="fb-status" id="fbDataStatus"></span>
                <input type="file" id="fbDataInput" accept=".json" onchange="handleLocalData(this)">
            </div>
        </div>
        
        <div class="tabs" id="tabsContainer"></div>

        <div id="statsArea" class="stats-grid"></div>
        
        <div class="filters-container">
            <div class="filters" id="filtersBox">
                <div class="filter-group">
                    <div class="filter-item">
                        <div class="filter-label">üìç ÏÑºÌÑ∞Íµ¨Î∂Ñ:</div>
                        <div class="filter-buttons" id="filter1"></div>
                    </div>
                    <div class="filter-item">
                        <div class="filter-label">üè¢ ÏÑºÌÑ∞ÏÑ†ÌÉù:</div>
                        <div class="filter-buttons" id="filter2"></div>
                    </div>
                    <div class="filter-item">
                        <div class="filter-label">üí∞ Ïú†Î¨¥ÏÉÅ Íµ¨Î∂Ñ:</div>
                        <div class="filter-buttons" id="filter3"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="chartContainer"></div>
        
        <div id="detailCards"></div>
    </div>

    <!-- Ïª®Î≤ÑÌÑ∞ Îç∞Ïù¥ÌÑ∞ ÏûêÎèô Í∞êÏßÄ (Í∞ôÏùÄ Ìè¥ÎçîÏùò data_service.js) -->
    <script src="data_service.js" onerror="this.onerror=null;this.remove()"></script>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <script>
    // ====================================================================
    // DataLoader - Ïô∏Î∂Ä JSON Îç∞Ïù¥ÌÑ∞ Î°úÎî© ÌÅ¥ÎûòÏä§
    // ====================================================================
    var DataLoader = {
        manifest: null,
        cache: {},
        basePath: 'data/',
        isLocal: location.protocol === 'file:',

        showLoading: function() {
            document.getElementById('loadingOverlay').classList.add('show');
        },
        hideLoading: function() {
            document.getElementById('loadingOverlay').classList.remove('show');
        },
        showError: function(msg) {
            var banner = document.getElementById('errorBanner');
            banner.textContent = '‚ö†Ô∏è ' + msg;
            banner.classList.add('show');
        },
        hideError: function() {
            document.getElementById('errorBanner').classList.remove('show');
        },

        loadManifest: async function() {
            if (this.isLocal) {
                document.getElementById('fileFallback').classList.add('show');
                return null; // ÌååÏùº ÏÑ†ÌÉù ÎåÄÍ∏∞
            }
            try {
                var response = await fetch('manifest.json?t=' + Date.now());
                if (!response.ok) throw new Error('manifest.jsonÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                this.manifest = await response.json();
                return this.manifest;
            } catch (e) {
                this.showError('manifest.json Î°úÎìú Ïã§Ìå®: ' + e.message);
                return null;
            }
        },

        dataType: 'reception',

        loadPeriod: async function(periodId) {
            var cacheKey = periodId + '_' + this.dataType;
            if (this.cache[cacheKey]) {
                return this.cache[cacheKey];
            }
            
            if (this.isLocal) {
                // Î°úÏª¨ Î™®Îìú: Îç∞Ïù¥ÌÑ∞ ÌååÏùº ÏÑ†ÌÉù ÏöîÏ≤≠
                document.getElementById('fbDataRow').style.display = 'flex';
                document.getElementById('fbDataStatus').textContent = '‚Üê ' + periodId + '-' + this.dataType + '.json ÏÑ†ÌÉù';
                return null;
            }
            
            this.showLoading();
            this.hideError();
            
            try {
                var periodMeta = this.manifest.periods.find(function(p) { return p.id === periodId; });
                var url;
                if (periodMeta && periodMeta.files && periodMeta.files[this.dataType]) {
                    url = periodMeta.files[this.dataType] + '?t=' + Date.now();
                } else {
                    url = this.basePath + periodId + '-' + this.dataType + '.json?t=' + Date.now();
                }
                
                var response = await fetch(url);
                if (!response.ok) throw new Error(url + 'ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                
                var data = await response.json();
                this.cache[cacheKey] = data;
                this.hideLoading();
                return data;
            } catch (e) {
                this.hideLoading();
                this.showError('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®: ' + e.message);
                return null;
            }
        },

        populatePeriodSelector: function() {
            var selector = document.getElementById('periodSelector');
            selector.innerHTML = '';
            
            if (!this.manifest || !this.manifest.periods || this.manifest.periods.length === 0) {
                selector.innerHTML = '<option value="">ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</option>';
                return;
            }

            var periods = this.manifest.periods.slice().sort(function(a, b) {
                return b.id.localeCompare(a.id);
            });

            periods.forEach(function(period) {
                var option = document.createElement('option');
                option.value = period.id;
                option.textContent = period.label || period.id;
                selector.appendChild(option);
            });
        }
    };

    // Î°úÏª¨ ÌååÏùº Î°úÎî© Ìï∏Îì§Îü¨ (localStorage Ï∫êÏã±)
    function handleLocalManifest(input) {
        if (!input.files[0]) return;
        var reader = new FileReader();
        reader.onload = function(e) {
            try {
                DataLoader.manifest = JSON.parse(e.target.result);
                // localStorageÏóê Ï∫êÏã±
                try { localStorage.setItem('__dash_manifest', e.target.result); } catch(x) {}
                DataLoader.populatePeriodSelector();
                document.getElementById('fbManifestBtn').classList.add('loaded');
                document.getElementById('fbManifestBtn').textContent = '‚úÖ Î°úÎìú ÏôÑÎ£å';
                document.getElementById('fbManifestStatus').textContent = DataLoader.manifest.periods.length + 'Í∞ú Í∏∞Í∞Ñ';
                document.getElementById('fbDataRow').style.display = 'flex';
                DataLoader.hideError();
            } catch (err) {
                DataLoader.showError('manifest.json ÌååÏã± Ïò§Î•ò: ' + err.message);
            }
        };
        reader.readAsText(input.files[0]);
    }

    function handleLocalData(input) {
        if (!input.files[0]) return;
        var reader = new FileReader();
        reader.onload = async function(e) {
            try {
                var data = JSON.parse(e.target.result);
                var periodId = document.getElementById('periodSelector').value;
                var cacheKey = periodId + '_' + DataLoader.dataType;
                DataLoader.cache[cacheKey] = data;
                // localStorageÏóê Ï∫êÏã±
                try { localStorage.setItem('__dash_' + cacheKey, e.target.result); } catch(x) {}
                document.getElementById('fbDataBtn').classList.add('loaded');
                document.getElementById('fbDataBtn').textContent = '‚úÖ Î°úÎìú ÏôÑÎ£å';
                document.getElementById('fbDataStatus').textContent = input.files[0].name;
                await app.changePeriod(periodId);
            } catch (err) {
                DataLoader.showError('Îç∞Ïù¥ÌÑ∞ ÌååÏã± Ïò§Î•ò: ' + err.message);
            }
        };
        reader.readAsText(input.files[0]);
    }

    // ====================================================================
    // App - Î©îÏù∏ ÎåÄÏãúÎ≥¥Îìú Î°úÏßÅ (Í∏∞Ï°¥ Î°úÏßÅ Ïú†ÏßÄ, Îç∞Ïù¥ÌÑ∞ Î°úÎî©Îßå Î≥ÄÍ≤Ω)
    // ====================================================================
    window.addEventListener('scroll', function() {
        var filtersBox = document.getElementById('filtersBox');
        if (filtersBox && window.scrollY > 300) {
            filtersBox.classList.add('scrolled');
        } else if (filtersBox) {
            filtersBox.classList.remove('scrolled');
        }
    });
    
    // DASHBOARD_DATAÎ•º Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú Ïú†ÏßÄ (Í∏∞Ï°¥ Î°úÏßÅ Ìò∏Ìôò)
    var DASHBOARD_DATA = null;

    var app = {
        currentTab: "Ï†ÑÏ≤¥",
        charts: [],
        filters: {
            "ÏÑºÌÑ∞Íµ¨Î∂Ñ": "Ï†ÑÏ≤¥",
            "ÏÑºÌÑ∞Íµ¨Î∂Ñ2": "Ï†ÑÏ≤¥",
            "Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨": "Ï†ÑÏ≤¥"
        },
        
        // üÜï Í∏∞Í∞Ñ Î≥ÄÍ≤Ω Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        changePeriod: async function(periodId) {
            var data = await DataLoader.loadPeriod(periodId);
            if (!data) return;
            
            DASHBOARD_DATA = data;
            
            // Í∏∞Í∞Ñ Ï†ïÎ≥¥ ÌëúÏãú
            var periodMeta = DataLoader.manifest.periods.find(function(p) { return p.id === periodId; });
            var info = document.getElementById('periodInfo');
            if (periodMeta && periodMeta.generated) {
                info.textContent = 'ÏÉùÏÑ±Ïùº: ' + periodMeta.generated;
            }
            
            // Î∂ÄÏ†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            var months = this.getMonthLabels();
            document.getElementById('subtitleText').textContent = 
                'Ï†ÑÏõî(' + months.last + ') vs ÎãπÏõî(' + months.current + ') Ìä∏Î†åÎìú ÎπÑÍµê - ÌïÑÌÑ∞ Ïó∞Îèô';
            
            // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî Î∞è Îã§Ïãú Î†åÎçîÎßÅ
            this.filters = { "ÏÑºÌÑ∞Íµ¨Î∂Ñ": "Ï†ÑÏ≤¥", "ÏÑºÌÑ∞Íµ¨Î∂Ñ2": "Ï†ÑÏ≤¥", "Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨": "Ï†ÑÏ≤¥" };
            this.initFilters();
            this.render();
        },

        // üÜï Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ïõî ÎùºÎ≤® Ï∂îÏ∂ú
        getMonthLabels: function() {
            if (!DASHBOARD_DATA || !DASHBOARD_DATA.aggregated_data) return { last: '?', current: '?' };
            var allData = DASHBOARD_DATA.aggregated_data["Ï†ÑÏ≤¥|Ï†ÑÏ≤¥|Ï†ÑÏ≤¥"];
            if (!allData || !allData.monthly_stats) return { last: '?', current: '?' };
            
            var months = Object.keys(allData.monthly_stats).sort();
            if (months.length >= 2) {
                return { 
                    last: months[0].replace(/^\d{4}-/, '') + 'Ïõî', 
                    current: months[1].replace(/^\d{4}-/, '') + 'Ïõî' 
                };
            }
            return { last: '?', current: '?' };
        },
        
        switchTab: function(tab) {
            this.currentTab = tab;
            document.querySelectorAll('.tab').forEach(function(t) { 
                t.classList.remove('active'); 
            });
            var activeTab = document.querySelector('[data-tab="' + tab + '"]');
            if (activeTab) activeTab.classList.add('active');
            this.render();
        },
        
        setFilter: function(type, value) {
            this.filters[type] = value;
            this.updateFilterButtons();
            this.render();
        },
        
        updateFilterButtons: function() {
            document.querySelectorAll('.filter-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            
            var filter1 = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ"];
            var filter2 = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ2"];
            var filter3 = this.filters["Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨"];
            
            document.querySelectorAll('[data-filter="' + filter1 + '"]').forEach(function(btn) {
                btn.classList.add('active');
            });
            document.querySelectorAll('[data-filter="' + filter2 + '"]').forEach(function(btn) {
                btn.classList.add('active');
            });
            document.querySelectorAll('[data-filter="' + filter3 + '"]').forEach(function(btn) {
                btn.classList.add('active');
            });
        },
        
        destroyCharts: function() {
            this.charts.forEach(function(chart) { 
                if (chart) chart.destroy(); 
            });
            this.charts = [];
        },
        
        getCurrentData: function() {
            if (!DASHBOARD_DATA) return null;
            var key = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ"] + "|" + this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ2"] + "|" + this.filters["Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨"];
            return DASHBOARD_DATA.aggregated_data[key] || DASHBOARD_DATA.aggregated_data["Ï†ÑÏ≤¥|Ï†ÑÏ≤¥|Ï†ÑÏ≤¥"];
        },
        
        getFilterDescription: function() {
            var f1 = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ"];
            var f2 = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ2"];
            var f3 = this.filters["Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨"];
            
            var parts = [];
            if (f1 !== "Ï†ÑÏ≤¥") parts.push(f1);
            if (f2 !== "Ï†ÑÏ≤¥") parts.push(f2);
            if (f3 !== "Ï†ÑÏ≤¥") {
                if (f3 === "Y") parts.push("Ïú†ÏÉÅ");
                else if (f3 === "N") parts.push("Î¨¥ÏÉÅ");
                else parts.push(f3);
            }
            
            return parts.length > 0 ? " (" + parts.join(" + ") + ")" : "";
        },
        
        initTabs: function() {
            var tabsHtml = '';
            var tabs = ['Ï†ÑÏ≤¥', 'Ï†úÌíàÎ≥Ñ', 'ÏÑúÎπÑÏä§Î≥Ñ', 'ÏÑºÌÑ∞Î≥Ñ'];
            var self = this;
            
            tabs.forEach(function(tab, index) {
                var activeClass = index === 0 ? ' active' : '';
                tabsHtml += '<button class="tab' + activeClass + '" data-tab="' + tab + '">' + tab + '</button>';
            });
            
            document.getElementById('tabsContainer').innerHTML = tabsHtml;
            
            document.querySelectorAll('.tab').forEach(function(tabEl) {
                tabEl.addEventListener('click', function() {
                    self.switchTab(this.getAttribute('data-tab'));
                });
            });
        },
        
        initFilters: function() {
            if (!DASHBOARD_DATA) return;
            var data = DASHBOARD_DATA;
            var self = this;
            
            var html1 = '<button class="filter-btn active" data-filter="Ï†ÑÏ≤¥" data-type="center1">Ï†ÑÏ≤¥</button>';
            (data.filter_options["ÏÑºÌÑ∞Íµ¨Î∂Ñ"] || []).forEach(function(opt) {
                html1 += '<button class="filter-btn" data-filter="' + opt + '" data-type="center1">' + opt + '</button>';
            });
            document.getElementById('filter1').innerHTML = html1;
            
            var html2 = '<button class="filter-btn active" data-filter="Ï†ÑÏ≤¥" data-type="center2">Ï†ÑÏ≤¥</button>';
            (data.filter_options["ÏÑºÌÑ∞Íµ¨Î∂Ñ2"] || []).forEach(function(opt) {
                html2 += '<button class="filter-btn" data-filter="' + opt + '" data-type="center2">' + opt + '</button>';
            });
            document.getElementById('filter2').innerHTML = html2;
            
            var html3 = '<button class="filter-btn active" data-filter="Ï†ÑÏ≤¥" data-type="payment">Ï†ÑÏ≤¥</button>';
            html3 += '<button class="filter-btn" data-filter="Y" data-type="payment">Ïú†ÏÉÅ</button>';
            html3 += '<button class="filter-btn" data-filter="N" data-type="payment">Î¨¥ÏÉÅ</button>';
            html3 += '<button class="filter-btn" data-filter="ÎØ∏Ï≤òÎ¶¨" data-type="payment">ÎØ∏Ï≤òÎ¶¨</button>';
            document.getElementById('filter3').innerHTML = html3;
            
            document.querySelectorAll('#filter1 .filter-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    self.setFilter('ÏÑºÌÑ∞Íµ¨Î∂Ñ', this.getAttribute('data-filter'));
                });
            });
            document.querySelectorAll('#filter2 .filter-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    self.setFilter('ÏÑºÌÑ∞Íµ¨Î∂Ñ2', this.getAttribute('data-filter'));
                });
            });
            document.querySelectorAll('#filter3 .filter-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    self.setFilter('Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨', this.getAttribute('data-filter'));
                });
            });
        },
        
        renderStats: function() {
            var data = this.getCurrentData();
            if (!data) return;
            
            var monthKeys = Object.keys(data.monthly_stats).sort();
            var lastMonth = data.monthly_stats[monthKeys[0]];
            var thisMonth = data.monthly_stats[monthKeys[1]];
            var months = this.getMonthLabels();
            
            var avgChange = thisMonth["ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥"] - lastMonth["ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥"];
            var avgChangePercent = lastMonth["ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥"] > 0 
                ? ((avgChange / lastMonth["ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥"]) * 100).toFixed(1)
                : 0;

            document.getElementById('statsArea').innerHTML = 
                '<div class="stat-card" style="background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%); border-color: #A5B4FC;">' +
                    '<div class="stat-label" style="color: #4C1D95;">Ï†ÑÏõî Ï¥ù Ï†ëÏàò</div>' +
                    '<div class="stat-value" style="color: #5B21B6;">' + lastMonth["Ï†ëÏàòÍ±¥Ïàò"].toLocaleString() + 'Í±¥</div>' +
                    '<div class="stat-badge" style="color: #6366F1; background: rgba(99, 102, 241, 0.1);">' +
                        'ÎãπÏõîÏ≤òÎ¶¨Ïú® ' + lastMonth["ÎãπÏõîÏ≤òÎ¶¨Ïú®"].toFixed(1) + '%' +
                    '</div>' +
                '</div>' +
                '<div class="stat-card" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-color: #FCD34D;">' +
                    '<div class="stat-label" style="color: #78350F;">ÎãπÏõî Ï¥ù Ï†ëÏàò</div>' +
                    '<div class="stat-value" style="color: #92400E;">' + thisMonth["Ï†ëÏàòÍ±¥Ïàò"].toLocaleString() + 'Í±¥</div>' +
                    '<div class="stat-badge" style="color: #F59E0B; background: rgba(245, 158, 11, 0.1);">' +
                        'ÎãπÏõîÏ≤òÎ¶¨Ïú® ' + thisMonth["ÎãπÏõîÏ≤òÎ¶¨Ïú®"].toFixed(1) + '%' +
                    '</div>' +
                '</div>' +
                '<div class="stat-card" style="background: linear-gradient(135deg, #E9D5FF 0%, #D8B4FE 100%); border-color: #C084FC;">' +
                    '<div class="stat-label" style="color: #581C87;">Ï†ÑÏõî ÏùºÌèâÍ∑†</div>' +
                    '<div class="stat-value" style="color: #6B21A8;">' + Math.round(lastMonth["ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥"]).toLocaleString() + 'Í±¥</div>' +
                '</div>' +
                '<div class="stat-card" style="background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%); border-color: #F9A8D4;">' +
                    '<div class="stat-label" style="color: #831843;">ÎãπÏõî ÏùºÌèâÍ∑†</div>' +
                    '<div class="stat-value" style="color: #9F1239;">' + Math.round(thisMonth["ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥"]).toLocaleString() + 'Í±¥</div>' +
                '</div>' +
                '<div class="stat-card" style="background: ' + (avgChange >= 0 ? 'linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%)' : 'linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%)') + '; border-color: ' + (avgChange >= 0 ? '#6EE7B7' : '#FCA5A5') + ';">' +
                    '<div class="stat-label" style="color: ' + (avgChange >= 0 ? '#065F46' : '#991B1B') + ';">ÌèâÍ∑† Î≥ÄÌôîÏú®</div>' +
                    '<div class="stat-value" style="color: ' + (avgChange >= 0 ? '#047857' : '#DC2626') + ';">' + (avgChange >= 0 ? '+' : '') + avgChangePercent + '%</div>' +
                '</div>';
        },
        
        renderDetailCards: function() {
            var detailContainer = document.getElementById('detailCards');
            var data = this.getCurrentData();
            if (!data) { detailContainer.innerHTML = ''; return; }
            var cardsHtml = '';
            var months = this.getMonthLabels();
            
            // === Ï†úÌíàÎ≥Ñ ÌÉ≠ ÏÉÅÏÑ∏ ÌÜµÍ≥Ñ ===
            if (this.currentTab === "Ï†úÌíàÎ≥Ñ") {
                var products = data.products || {};
                var sorted = [];
                for (var name in products) {
                    var counts = products[name];
                    var change = counts.thisMonth - counts.lastMonth;
                    var changeRate = counts.lastMonth > 0 ? ((change / counts.lastMonth) * 100) : (counts.thisMonth > 0 ? 100 : 0);
                    sorted.push({ name: name, lastMonth: counts.lastMonth, thisMonth: counts.thisMonth, change: change, changeRate: changeRate });
                }
                sorted.sort(function(a, b) { return Math.abs(b.change) - Math.abs(a.change); });
                
                var top5Increase = sorted.filter(function(x) { return x.change > 0; }).slice(0, 5);
                var top5Decrease = sorted.filter(function(x) { return x.change < 0; }).slice(0, 5);
                
                if (top5Increase.length > 0 || top5Decrease.length > 0) {
                    cardsHtml += '<div class="product-cards-container">';
                    cardsHtml += '<h3 class="product-cards-title">Ï†úÌíàÎ≥Ñ Ï†ëÏàòÍ±¥ ÏÉÅÏÑ∏ÌòÑÌô©</h3>';
                    cardsHtml += '<p class="product-cards-subtitle">Ï¶ùÍ∞ÄÏú® ÏÉÅÏúÑ 5Í∞ú Î∞è Í∞êÏÜåÏú® ÏÉÅÏúÑ 5Í∞ú</p>';
                    cardsHtml += '<div class="product-cards-grid">';
                    
                    top5Increase.forEach(function(item) {
                        cardsHtml += '<div class="product-card increase">';
                        cardsHtml += '<div class="product-card-badge increase">‚ñ≤ Ï¶ùÍ∞Ä</div>';
                        cardsHtml += '<div class="product-card-name">' + item.name + '</div>';
                        cardsHtml += '<div class="product-card-stat"><span class="product-card-stat-label">Ï†ÑÏõî</span><span class="product-card-stat-value orange">' + item.lastMonth.toLocaleString() + 'Í±¥</span></div>';
                        cardsHtml += '<div class="product-card-stat"><span class="product-card-stat-label">ÎãπÏõî</span><span class="product-card-stat-value blue">' + item.thisMonth.toLocaleString() + 'Í±¥</span></div>';
                        cardsHtml += '<div class="product-card-change-box increase"><div class="product-card-change-label">Ï†ÑÏõî ÎåÄÎπÑ</div>+' + item.change.toLocaleString() + 'Í±¥ (+' + item.changeRate.toFixed(1) + '%)</div>';
                        cardsHtml += '</div>';
                    });
                    
                    top5Decrease.forEach(function(item) {
                        cardsHtml += '<div class="product-card decrease">';
                        cardsHtml += '<div class="product-card-badge decrease">‚ñº Í∞êÏÜå</div>';
                        cardsHtml += '<div class="product-card-name">' + item.name + '</div>';
                        cardsHtml += '<div class="product-card-stat"><span class="product-card-stat-label">Ï†ÑÏõî</span><span class="product-card-stat-value orange">' + item.lastMonth.toLocaleString() + 'Í±¥</span></div>';
                        cardsHtml += '<div class="product-card-stat"><span class="product-card-stat-label">ÎãπÏõî</span><span class="product-card-stat-value blue">' + item.thisMonth.toLocaleString() + 'Í±¥</span></div>';
                        cardsHtml += '<div class="product-card-change-box decrease"><div class="product-card-change-label">Ï†ÑÏõî ÎåÄÎπÑ</div>' + item.change.toLocaleString() + 'Í±¥ (' + item.changeRate.toFixed(1) + '%)</div>';
                        cardsHtml += '</div>';
                    });
                    
                    cardsHtml += '</div></div>';
                }
            }
            
            // === ÏÑºÌÑ∞Î≥Ñ ÌÉ≠ ÏÉÅÏÑ∏ Ïπ¥Îìú ===
            if (this.currentTab === "ÏÑºÌÑ∞Î≥Ñ") {
                var locationsDetail = data.locations_detail || {};
                var locationToCenter = DASHBOARD_DATA.location_to_center || {};
                var allLocations = [];
                for (var locName in locationsDetail) {
                    var stats = locationsDetail[locName];
                    var change = stats.thisMonth - stats.lastMonth;
                    var changeRate = stats.lastMonth > 0 ? ((change / stats.lastMonth) * 100) : (stats.thisMonth > 0 ? 100 : 0);
                    allLocations.push({
                        name: locName,
                        type: locationToCenter[locName] || 'Í∏∞ÌÉÄ',
                        lastMonth: stats.lastMonth,
                        thisMonth: stats.thisMonth,
                        change: change,
                        changeRate: changeRate,
                        faults: stats.faults || []
                    });
                }
                allLocations.sort(function(a, b) { return Math.abs(b.change) - Math.abs(a.change); });
                
                var top5Up = allLocations.filter(function(x) { return x.change > 0; }).slice(0, 5);
                var top5Down = allLocations.filter(function(x) { return x.change < 0; }).slice(0, 5);
                var combined = top5Up.concat(top5Down);
                
                if (combined.length > 0) {
                    cardsHtml += '<div class="detail-cards"><h3 class="detail-cards-title">ÏÑºÌÑ∞Î≥Ñ Ï¶ùÍ∞ê ÏÉÅÏúÑ ÌòÑÌô©</h3>';
                    cardsHtml += '<p class="detail-cards-subtitle">Ï†ÑÏõî ÎåÄÎπÑ Ï¶ùÍ∞Ä/Í∞êÏÜå ÏÉÅÏúÑ 5Í∞ú ÏÑºÌÑ∞</p>';
                    cardsHtml += '<div class="cards-grid">';
                    
                    combined.forEach(function(item) {
                        var cls = item.change >= 0 ? 'increase' : 'decrease';
                        var arrow = item.change >= 0 ? '‚ñ≤' : '‚ñº';
                        
                        cardsHtml += '<div class="detail-card ' + cls + '">';
                        cardsHtml += '<div class="card-badge ' + cls + '">' + arrow + ' ' + (item.change >= 0 ? 'Ï¶ùÍ∞Ä' : 'Í∞êÏÜå') + '</div>';
                        cardsHtml += '<div class="card-name">' + item.name + '</div>';
                        cardsHtml += '<div class="card-row"><span class="card-row-label">Ï†ÑÏõî</span><span class="card-row-value">' + item.lastMonth.toLocaleString() + 'Í±¥</span></div>';
                        cardsHtml += '<div class="card-row"><span class="card-row-label">ÎãπÏõî</span><span class="card-row-value">' + item.thisMonth.toLocaleString() + 'Í±¥</span></div>';
                        cardsHtml += '<div class="card-change ' + cls + '">' + (item.change >= 0 ? '+' : '') + item.change.toLocaleString() + 'Í±¥ (' + item.changeRate.toFixed(1) + '%)</div>';
                        
                        // Í≥†Ïû• ÏÉÅÏÑ∏
                        if (item.faults && item.faults.length > 0) {
                            cardsHtml += '<div class="fault-section"><div class="fault-title">üîß Í≥†Ïû•ÎÇ¥Ïö©ÏÜåÎ∂ÑÎ•ò ÏÉÅÏúÑ</div>';
                            item.faults.slice(0, 5).forEach(function(fault) {
                                var total = fault.lastMonth + fault.thisMonth;
                                cardsHtml += '<div class="fault-item"><span class="fault-name">' + fault.name + '</span><span class="fault-count">' + total.toLocaleString() + 'Í±¥</span><span class="fault-percentage">(Ï†ÑÏõî ' + fault.lastMonth + ' / ÎãπÏõî ' + fault.thisMonth + ')</span></div>';
                            });
                            cardsHtml += '</div>';
                        }
                        
                        cardsHtml += '</div>';
                    });
                    
                    cardsHtml += '</div></div>';
                }
            }
            
            detailContainer.innerHTML = cardsHtml;
        },
        
        renderCharts: function() {
            this.destroyCharts();
            var container = document.getElementById('chartContainer');
            var data = this.getCurrentData();
            if (!data) { container.innerHTML = ''; return; }
            
            var filterDesc = this.getFilterDescription();
            var months = this.getMonthLabels();
            var monthKeys = Object.keys(data.monthly_stats).sort();
            
            if (this.currentTab === "Ï†ÑÏ≤¥") {
                // ÏùºÏûêÎ≥Ñ Ï∞®Ìä∏ + Î∂ÑÏÑù
                var analysisHtml = '';
                
                if (data.analysis) {
                    var analysis = data.analysis;
                    analysisHtml = '<div class="analysis-section"><div class="analysis-title">üìà Ï£ºÏöî Ï¶ùÍ∞ê Î∂ÑÏÑù' + filterDesc + '</div>';
                    analysisHtml += '<div class="analysis-subtitle">Ï†ÑÏõî ÎåÄÎπÑ Í∞ÄÏû• ÌÅ∞ Î≥ÄÌôîÎ•º Î≥¥Ïù∏ Ï†úÌíà/ÏÑºÌÑ∞</div>';
                    analysisHtml += '<div class="analysis-grid">';
                    
                    // Ï¶ùÍ∞Ä Ìï≠Î™©
                    if (analysis.increase && analysis.increase.length > 0) {
                        analysisHtml += '<div class="analysis-box increase"><div class="analysis-box-title">üìà Ï¶ùÍ∞Ä ÏÉÅÏúÑ</div>';
                        analysis.increase.forEach(function(item, idx) {
                            var itemId = 'analysis-inc-' + idx;
                            var faultDetails = item.faults || [];
                            analysisHtml += '<div class="analysis-item increase" data-item-id="' + itemId + '">';
                            analysisHtml += '<div class="analysis-item-header">' + item.name + '</div>';
                            analysisHtml += '<div class="analysis-item-detail">Ï†ÑÏõî ' + item.lastMonth + 'Í±¥ ‚Üí ÎãπÏõî ' + item.thisMonth + 'Í±¥</div>';
                            analysisHtml += '<div class="analysis-item-change increase">+' + item.change + 'Í±¥ (+' + item.changeRate.toFixed(1) + '%)</div>';
                            
                            if (faultDetails.length > 0) {
                                analysisHtml += '<div class="analysis-item-details" id="' + itemId + '">';
                                analysisHtml += '<div class="analysis-detail-title">üîß Í≥†Ïû•ÎÇ¥Ïö©ÏÜåÎ∂ÑÎ•ò ÏÉÅÏúÑ 5Í∞ú</div>';
                                faultDetails.forEach(function(fault) {
                                    var totalCount = fault.lastMonth + fault.thisMonth;
                                    analysisHtml += '<div class="analysis-fault-item"><span class="analysis-fault-name">' + fault.name + '</span><span class="analysis-fault-count">' + totalCount.toLocaleString() + 'Í±¥</span><span class="analysis-fault-percentage">(Ï†ÑÏõî ' + fault.lastMonth + ' / ÎãπÏõî ' + fault.thisMonth + ')</span></div>';
                                });
                                analysisHtml += '</div>';
                            }
                            analysisHtml += '</div>';
                        });
                        analysisHtml += '</div>';
                    }
                    
                    // Í∞êÏÜå Ìï≠Î™©
                    if (analysis.decrease && analysis.decrease.length > 0) {
                        analysisHtml += '<div class="analysis-box decrease"><div class="analysis-box-title">üìâ Í∞êÏÜå ÏÉÅÏúÑ</div>';
                        analysis.decrease.forEach(function(item, idx) {
                            var itemId = 'analysis-dec-' + idx;
                            var faultDetails = item.faults || [];
                            analysisHtml += '<div class="analysis-item decrease" data-item-id="' + itemId + '">';
                            analysisHtml += '<div class="analysis-item-header">' + item.name + '</div>';
                            analysisHtml += '<div class="analysis-item-detail">Ï†ÑÏõî ' + item.lastMonth + 'Í±¥ ‚Üí ÎãπÏõî ' + item.thisMonth + 'Í±¥</div>';
                            analysisHtml += '<div class="analysis-item-change decrease">' + item.change + 'Í±¥ (' + item.changeRate.toFixed(1) + '%)</div>';
                            
                            if (faultDetails.length > 0) {
                                analysisHtml += '<div class="analysis-item-details" id="' + itemId + '">';
                                analysisHtml += '<div class="analysis-detail-title">üîß Í≥†Ïû•ÎÇ¥Ïö©ÏÜåÎ∂ÑÎ•ò ÏÉÅÏúÑ 5Í∞ú</div>';
                                faultDetails.forEach(function(fault) {
                                    var totalCount = fault.lastMonth + fault.thisMonth;
                                    analysisHtml += '<div class="analysis-fault-item"><span class="analysis-fault-name">' + fault.name + '</span><span class="analysis-fault-count">' + totalCount.toLocaleString() + 'Í±¥</span><span class="analysis-fault-percentage">(Ï†ÑÏõî ' + fault.lastMonth + ' / ÎãπÏõî ' + fault.thisMonth + ')</span></div>';
                                });
                                analysisHtml += '</div>';
                            }
                            analysisHtml += '</div>';
                        });
                        analysisHtml += '</div>';
                    }
                    
                    analysisHtml += '</div></div>';
                }
                
                container.innerHTML = '<div class="chart-container"><h3 class="chart-title">ÏùºÏûêÎ≥Ñ Ï†ëÏàòÍ±¥ ÌòÑÌô©' + filterDesc + '</h3><p class="chart-description">Ï†ÑÏõî(' + months.last + ')Í≥º ÎãπÏõî(' + months.current + ')Ïùò ÏùºÎ≥Ñ Ï†ëÏàò Ï∂îÏù¥Î•º ÎπÑÍµêÌï©ÎãàÎã§ (ÌòÑÏû¨ ÌïÑÌÑ∞ Ï†ÅÏö©)</p><div class="chart-wrapper"><canvas id="chart1"></canvas></div>' + analysisHtml + '</div>';
                var dailyData = data.daily_chart_data;
                var ctx = document.getElementById('chart1').getContext('2d');
                this.charts.push(new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dailyData.map(function(d) { return d.day; }),
                        datasets: [{label: 'Ï†ÑÏõî (' + months.last + ')', data: dailyData.map(function(d) { return d.lastMonth; }), borderColor: '#A5B4FC', backgroundColor: 'rgba(165, 180, 252, 0.2)', borderWidth: 3, tension: 0.3, fill: true}, {label: 'ÎãπÏõî (' + months.current + ')', data: dailyData.map(function(d) { return d.thisMonth; }), borderColor: '#FCD34D', backgroundColor: 'rgba(252, 211, 77, 0.2)', borderWidth: 3, tension: 0.3, fill: true}]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: {legend: {position: 'top', labels: {font: {size: 13, weight: '600'}, padding: 15}}, tooltip: {callbacks: {label: function(context) {return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + 'Í±¥';}}}},
                        scales: {y: {beginAtZero: true, ticks: {callback: function(value) {return value.toLocaleString() + 'Í±¥';}}}}
                    }
                }));
            } else if (this.currentTab === "Ï†úÌíàÎ≥Ñ") {
                var products = data.products || {};
                var sorted = [];
                for (var name in products) {
                    var counts = products[name];
                    sorted.push({name: name, lastMonth: counts.lastMonth, thisMonth: counts.thisMonth, total: counts.lastMonth + counts.thisMonth});
                }
                sorted.sort(function(a, b) { return b.total - a.total; });
                var top10 = sorted.slice(0, 10);
                var others = sorted.slice(10);
                var othersSum = {lastMonth: 0, thisMonth: 0};
                others.forEach(function(item) {othersSum.lastMonth += item.lastMonth; othersSum.thisMonth += item.thisMonth;});
                var chartData = top10.slice();
                if (othersSum.lastMonth > 0 || othersSum.thisMonth > 0) {chartData.push({name: 'Í∏∞ÌÉÄ Ï†úÌíàÍµ∞', lastMonth: othersSum.lastMonth, thisMonth: othersSum.thisMonth});}
                container.innerHTML = '<div class="chart-container"><h3 class="chart-title">Ï†úÌíàÎ≥Ñ Ï†ëÏàò ÌòÑÌô©</h3><p class="chart-description">ÏÉÅÏúÑ 10Í∞ú Ï†úÌíà + Í∏∞ÌÉÄ Ï†úÌíàÍµ∞ (Ï¥ù ' + sorted.length + 'Í∞ú Ï†úÌíà)</p><div class="chart-wrapper"><canvas id="chart1"></canvas></div></div>';
                var ctx = document.getElementById('chart1').getContext('2d');
                this.charts.push(new Chart(ctx, {
                    type: 'bar',
                    data: {labels: chartData.map(function(d) { return d.name; }), datasets: [{label: 'Ï†ÑÏõî', data: chartData.map(function(d) { return d.lastMonth; }), backgroundColor: '#A5B4FC', borderRadius: 8}, {label: 'ÎãπÏõî', data: chartData.map(function(d) { return d.thisMonth; }), backgroundColor: '#FCD34D', borderRadius: 8}]},
                    options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {position: 'top', labels: {font: {size: 13, weight: '600'}}}}, scales: {y: {beginAtZero: true, ticks: {callback: function(value) {return value.toLocaleString() + 'Í±¥';}}}, x: {ticks: {maxRotation: 45, minRotation: 45}}}}
                }));
            } else if (this.currentTab === "ÏÑúÎπÑÏä§Î≥Ñ") {
                var services = data.services || {};
                var chartData = [];
                for (var name in services) {
                    var counts = services[name];
                    chartData.push({name: name, lastMonth: counts.lastMonth, thisMonth: counts.thisMonth});
                }
                container.innerHTML = '<div class="chart-container"><h3 class="chart-title">ÏÑúÎπÑÏä§Î≥Ñ Ï†ëÏàò ÌòÑÌô©</h3><p class="chart-description">Ï†ÑÏ≤¥ ÏÑúÎπÑÏä§ Íµ¨Î∂ÑÎ≥Ñ Ï†ëÏàò ÌòÑÌô©</p><div class="chart-wrapper"><canvas id="chart1"></canvas></div></div>';
                var ctx = document.getElementById('chart1').getContext('2d');
                this.charts.push(new Chart(ctx, {
                    type: 'bar',
                    data: {labels: chartData.map(function(d) { return d.name; }), datasets: [{label: 'Ï†ÑÏõî', data: chartData.map(function(d) { return d.lastMonth; }), backgroundColor: '#A5B4FC', borderRadius: 8}, {label: 'ÎãπÏõî', data: chartData.map(function(d) { return d.thisMonth; }), backgroundColor: '#FCD34D', borderRadius: 8}]},
                    options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {position: 'top', labels: {font: {size: 13, weight: '600'}}}}, scales: {y: {beginAtZero: true, ticks: {callback: function(value) {return value.toLocaleString() + 'Í±¥';}}}}}
                }));
            } else if (this.currentTab === "ÏÑºÌÑ∞Î≥Ñ") {
                var locationsDetail = data.locations_detail || {};
                var locationToCenter = DASHBOARD_DATA.location_to_center || {};
                var installLocations = [], storeLocations = [];
                for (var name in locationsDetail) {
                    var stats = locationsDetail[name];
                    var centerType = locationToCenter[name];
                    var item = {name: name, lastMonth: stats.lastMonth, thisMonth: stats.thisMonth, total: stats.lastMonth + stats.thisMonth};
                    if (centerType === "ÏÑ§ÏπòÎ≤ïÏù∏") {installLocations.push(item);} else if (centerType === "Ïä§ÌÜ†Ïñ¥") {storeLocations.push(item);}
                }
                installLocations.sort(function(a, b) { return b.total - a.total; });
                storeLocations.sort(function(a, b) { return b.total - a.total; });
                var top5Install = installLocations.slice(0, 5);
                var top5Store = storeLocations.slice(0, 5);
                container.innerHTML = '<div class="charts-row"><div class="chart-small"><h3 class="chart-title">ÏÑ§ÏπòÎ≤ïÏù∏ ÏÉÅÏúÑ 5Í∞ú</h3><p class="chart-description">Ï¥ù ' + installLocations.length + 'Í∞ú ÏÑ§ÏπòÎ≤ïÏù∏ Ï§ë ÏÉÅÏúÑ 5Í∞ú</p><div class="chart-wrapper"><canvas id="chart1"></canvas></div></div><div class="chart-small"><h3 class="chart-title">Ïä§ÌÜ†Ïñ¥ ÏÉÅÏúÑ 5Í∞ú</h3><p class="chart-description">Ï¥ù ' + storeLocations.length + 'Í∞ú Ïä§ÌÜ†Ïñ¥ Ï§ë ÏÉÅÏúÑ 5Í∞ú</p><div class="chart-wrapper"><canvas id="chart2"></canvas></div></div></div>';
                var ctx1 = document.getElementById('chart1').getContext('2d');
                this.charts.push(new Chart(ctx1, {type: 'bar', data: {labels: top5Install.map(function(d) { return d.name; }), datasets: [{label: 'Ï†ÑÏõî', data: top5Install.map(function(d) { return d.lastMonth; }), backgroundColor: '#A5B4FC', borderRadius: 8}, {label: 'ÎãπÏõî', data: top5Install.map(function(d) { return d.thisMonth; }), backgroundColor: '#FCD34D', borderRadius: 8}]}, options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {position: 'top', labels: {font: {size: 12, weight: '600'}}}}, scales: {y: {beginAtZero: true, ticks: {callback: function(v) {return v.toLocaleString() + 'Í±¥';}}}, x: {ticks: {maxRotation: 45, minRotation: 45}}}}}));
                var ctx2 = document.getElementById('chart2').getContext('2d');
                this.charts.push(new Chart(ctx2, {type: 'bar', data: {labels: top5Store.map(function(d) { return d.name; }), datasets: [{label: 'Ï†ÑÏõî', data: top5Store.map(function(d) { return d.lastMonth; }), backgroundColor: '#A5B4FC', borderRadius: 8}, {label: 'ÎãπÏõî', data: top5Store.map(function(d) { return d.thisMonth; }), backgroundColor: '#FCD34D', borderRadius: 8}]}, options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {position: 'top', labels: {font: {size: 12, weight: '600'}}}}, scales: {y: {beginAtZero: true, ticks: {callback: function(v) {return v.toLocaleString() + 'Í±¥';}}}, x: {ticks: {maxRotation: 45, minRotation: 45}}}}}));
            }
        },
        
        render: function() {
            this.renderStats();
            this.renderCharts();
            this.renderDetailCards();
            
            // Î∂ÑÏÑù Ìï≠Î™© ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            setTimeout(function() {
                var analysisItems = document.querySelectorAll('.analysis-item');
                analysisItems.forEach(function(item) {
                    item.addEventListener('click', function() {
                        var itemId = this.getAttribute('data-item-id');
                        var detailsDiv = document.getElementById(itemId);
                        if (detailsDiv) {
                            document.querySelectorAll('.analysis-item-details').forEach(function(div) {
                                if (div.id !== itemId) div.classList.remove('show');
                            });
                            analysisItems.forEach(function(otherItem) {
                                if (otherItem !== item) otherItem.classList.remove('active');
                            });
                            detailsDiv.classList.toggle('show');
                            item.classList.toggle('active');
                        }
                    });
                });
            }, 100);
        }
    };
    
    // ====================================================================
    // Ïª®Î≤ÑÌÑ∞ Îç∞Ïù¥ÌÑ∞ Î∏åÎ¶øÏßÄ - data_service.js ÏûêÎèô Í∞êÏßÄ Î∞è Î≥ÄÌôò
    // ====================================================================
    if (typeof SERVICE_DATA !== 'undefined' && Array.isArray(SERVICE_DATA) && SERVICE_DATA.length > 0) {
        (function() {
            var _raw = SERVICE_DATA;
            console.log('[Ïª®Î≤ÑÌÑ∞ Î∏åÎ¶øÏßÄ] SERVICE_DATA Í∞êÏßÄ: ' + _raw.length.toLocaleString() + 'Í±¥');
            
            // Ï†ëÏàòÏùºÏûê Í∏∞Ï§Ä Ïõî Í∞êÏßÄ
            var mCounts = {};
            _raw.forEach(function(r) {
                var m = r.Ï†ëÏàòÏùºÏûê ? r.Ï†ëÏàòÏùºÏûê.substring(0, 7) : '';
                if (m && m.length === 7) mCounts[m] = (mCounts[m] || 0) + 1;
            });
            var mKeys = Object.keys(mCounts).sort();
            var mLast = mKeys.length >= 2 ? mKeys[mKeys.length - 2] : (mKeys[0] || '');
            var mThis = mKeys.length >= 1 ? mKeys[mKeys.length - 1] : '';
            console.log('[Ïª®Î≤ÑÌÑ∞ Î∏åÎ¶øÏßÄ] Í∏∞Í∞Ñ: ' + mLast + ' vs ' + mThis + ' (' + mKeys.length + 'Í∞úÏõî Í∞êÏßÄ)');
            
            // ÌïÑÌÑ∞ ÏòµÏÖò ÏàòÏßë
            var cTypes = {}, cNames = {}, locMap = {};
            _raw.forEach(function(r) {
                if (r.ÏÑºÌÑ∞Íµ¨Î∂Ñ) cTypes[r.ÏÑºÌÑ∞Íµ¨Î∂Ñ] = 1;
                var name = r.Ïù¥Í¥ÄÏ≤òÎ™Ö || '';
                if (name) {
                    cNames[name] = 1;
                    locMap[name] = r.ÏÑºÌÑ∞Íµ¨Î∂Ñ || 'Í∏∞ÌÉÄ';
                }
            });
            
            // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞ Ìó¨Ìçº
            function computeStats(subset) {
                var mStats = {};
                mStats[mLast] = { Ï†ëÏàòÍ±¥Ïàò: 0, ÎãπÏõîÏ≤òÎ¶¨Í±¥Ïàò: 0, ÎãπÏõîÏ≤òÎ¶¨Ïú®: 0, ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥: 0 };
                mStats[mThis] = { Ï†ëÏàòÍ±¥Ïàò: 0, ÎãπÏõîÏ≤òÎ¶¨Í±¥Ïàò: 0, ÎãπÏõîÏ≤òÎ¶¨Ïú®: 0, ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥: 0 };
                var dL = {}, dT = {};
                var pL = {}, pT = {};
                var sL = {}, sT = {};
                var lL = {}, lT = {};
                
                subset.forEach(function(r) {
                    var m = r.Ï†ëÏàòÏùºÏûê ? r.Ï†ëÏàòÏùºÏûê.substring(0, 7) : '';
                    var day = r.Ï†ëÏàòÏùºÏûê ? parseInt(r.Ï†ëÏàòÏùºÏûê.substring(8)) : 0;
                    var pm = r.Ï≤òÎ¶¨ÏùºÏûê ? r.Ï≤òÎ¶¨ÏùºÏûê.substring(0, 7) : '';
                    var prod = r.Ï†úÌíàÍµ∞ || 'ÎØ∏Î∂ÑÎ•ò';
                    var svc = r.Ï†ëÏàòÍµ¨Î∂Ñ || 'ÎØ∏Î∂ÑÎ•ò';
                    var loc = r.Ïù¥Í¥ÄÏ≤òÎ™Ö || r.Ïù¥Í¥ÄÏ≤ò || 'ÎØ∏Î∂ÑÎ•ò';
                    
                    if (m === mLast) {
                        mStats[mLast].Ï†ëÏàòÍ±¥Ïàò++;
                        if (pm === mLast) mStats[mLast].ÎãπÏõîÏ≤òÎ¶¨Í±¥Ïàò++;
                        if (day) dL[day] = (dL[day] || 0) + 1;
                        pL[prod] = (pL[prod] || 0) + 1;
                        sL[svc] = (sL[svc] || 0) + 1;
                        lL[loc] = (lL[loc] || 0) + 1;
                    } else if (m === mThis) {
                        mStats[mThis].Ï†ëÏàòÍ±¥Ïàò++;
                        if (pm === mThis) mStats[mThis].ÎãπÏõîÏ≤òÎ¶¨Í±¥Ïàò++;
                        if (day) dT[day] = (dT[day] || 0) + 1;
                        pT[prod] = (pT[prod] || 0) + 1;
                        sT[svc] = (sT[svc] || 0) + 1;
                        lT[loc] = (lT[loc] || 0) + 1;
                    }
                });
                
                var daysL = Object.keys(dL).length || 1;
                var daysT = Object.keys(dT).length || 1;
                mStats[mLast].ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥ = mStats[mLast].Ï†ëÏàòÍ±¥Ïàò / daysL;
                mStats[mLast].ÎãπÏõîÏ≤òÎ¶¨Ïú® = mStats[mLast].Ï†ëÏàòÍ±¥Ïàò > 0 ? (mStats[mLast].ÎãπÏõîÏ≤òÎ¶¨Í±¥Ïàò / mStats[mLast].Ï†ëÏàòÍ±¥Ïàò * 100) : 0;
                mStats[mThis].ÏùºÌèâÍ∑†Ï†ëÏàòÍ±¥ = mStats[mThis].Ï†ëÏàòÍ±¥Ïàò / daysT;
                mStats[mThis].ÎãπÏõîÏ≤òÎ¶¨Ïú® = mStats[mThis].Ï†ëÏàòÍ±¥Ïàò > 0 ? (mStats[mThis].ÎãπÏõîÏ≤òÎ¶¨Í±¥Ïàò / mStats[mThis].Ï†ëÏàòÍ±¥Ïàò * 100) : 0;
                
                var daily = [];
                for (var d = 1; d <= 31; d++) daily.push({ day: d, lastMonth: dL[d] || 0, thisMonth: dT[d] || 0 });
                
                var allP = {};
                for (var k in pL) allP[k] = 1; for (var k in pT) allP[k] = 1;
                var products = {};
                for (var p in allP) products[p] = { lastMonth: pL[p] || 0, thisMonth: pT[p] || 0 };
                
                var allS = {};
                for (var k in sL) allS[k] = 1; for (var k in sT) allS[k] = 1;
                var services = {};
                for (var s in allS) services[s] = { lastMonth: sL[s] || 0, thisMonth: sT[s] || 0 };
                
                var allL = {};
                for (var k in lL) allL[k] = 1; for (var k in lT) allL[k] = 1;
                var locations_detail = {};
                for (var l in allL) locations_detail[l] = { lastMonth: lL[l] || 0, thisMonth: lT[l] || 0 };
                
                // Ï¶ùÍ∞ê Î∂ÑÏÑù
                var sorted = [];
                for (var pp in products) {
                    var ch = products[pp].thisMonth - products[pp].lastMonth;
                    var cr = products[pp].lastMonth > 0 ? (ch / products[pp].lastMonth * 100) : (products[pp].thisMonth > 0 ? 100 : 0);
                    sorted.push({ name: pp, lastMonth: products[pp].lastMonth, thisMonth: products[pp].thisMonth, change: ch, changeRate: cr, faults: [] });
                }
                var inc = sorted.filter(function(x) { return x.change > 0; }).sort(function(a, b) { return Math.abs(b.change) - Math.abs(a.change); }).slice(0, 5);
                var dec = sorted.filter(function(x) { return x.change < 0; }).sort(function(a, b) { return Math.abs(b.change) - Math.abs(a.change); }).slice(0, 5);
                
                return {
                    monthly_stats: mStats,
                    daily_chart_data: daily,
                    products: products,
                    services: services,
                    locations_detail: locations_detail,
                    analysis: { increase: inc, decrease: dec }
                };
            }
            
            // DataLoader Ïò§Î≤ÑÎùºÏù¥Îìú
            DataLoader.isLocal = false;
            DataLoader._converterMode = true;
            
            DataLoader.loadManifest = async function() {
                this.manifest = {
                    periods: [{
                        id: 'converter-data',
                        label: mLast.replace('-', 'ÎÖÑ ') + 'Ïõî vs ' + mThis.replace('-', 'ÎÖÑ ') + 'Ïõî',
                        generated: new Date().toISOString().substring(0, 10)
                    }]
                };
                return this.manifest;
            };
            
            DataLoader.loadPeriod = async function() {
                var defaultData = computeStats(_raw);
                return {
                    filter_options: {
                        "ÏÑºÌÑ∞Íµ¨Î∂Ñ": Object.keys(cTypes).sort(),
                        "ÏÑºÌÑ∞Íµ¨Î∂Ñ2": Object.keys(cNames).sort()
                    },
                    location_to_center: locMap,
                    aggregated_data: { "Ï†ÑÏ≤¥|Ï†ÑÏ≤¥|Ï†ÑÏ≤¥": defaultData }
                };
            };
            
            // getCurrentData Ïò§Î≤ÑÎùºÏù¥Îìú - ÌïÑÌÑ∞ Î≥ÄÍ≤Ω Ïãú ÎèôÏ†Å Í≥ÑÏÇ∞
            var _origGetCurrentData = app.getCurrentData;
            app.getCurrentData = function() {
                if (!DASHBOARD_DATA) return null;
                var key = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ"] + "|" + this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ2"] + "|" + this.filters["Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨"];
                if (DASHBOARD_DATA.aggregated_data[key]) return DASHBOARD_DATA.aggregated_data[key];
                
                // ÎèôÏ†Å Í≥ÑÏÇ∞
                var f1 = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ"];
                var f2 = this.filters["ÏÑºÌÑ∞Íµ¨Î∂Ñ2"];
                var f3 = this.filters["Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨"];
                var filtered = _raw.filter(function(r) {
                    if (f1 !== 'Ï†ÑÏ≤¥' && r.ÏÑºÌÑ∞Íµ¨Î∂Ñ !== f1) return false;
                    if (f2 !== 'Ï†ÑÏ≤¥' && (r.Ïù¥Í¥ÄÏ≤òÎ™Ö || '') !== f2) return false;
                    if (f3 !== 'Ï†ÑÏ≤¥') {
                        var u = r.Ïú†Î¨¥ÏÉÅÏ≤òÎ¶¨ || '';
                        if (f3 === 'ÎØ∏Ï≤òÎ¶¨') { if (u && u !== 'ÎØ∏Ï≤òÎ¶¨') return false; }
                        else { if (u !== f3) return false; }
                    }
                    return true;
                });
                var result = computeStats(filtered);
                DASHBOARD_DATA.aggregated_data[key] = result;
                return result;
            };
            
            console.log('[Ïª®Î≤ÑÌÑ∞ Î∏åÎ¶øÏßÄ] index.html Ïó∞Îèô Ï§ÄÎπÑ ÏôÑÎ£å');
        })();
    }
    
    // ====================================================================
    // Ï¥àÍ∏∞Ìôî - manifest ‚Üí Í∏∞Í∞Ñ ÏÑ†ÌÉù ‚Üí Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    // ====================================================================
    window.addEventListener('load', async function() {
        app.initTabs();
        
        // 1. manifest Î°úÎìú (file:// Î™®ÎìúÎ©¥ localStorage Ï∫êÏãú ÌôïÏù∏)
        var manifest = await DataLoader.loadManifest();
        
        if (!manifest && DataLoader.isLocal) {
            // localStorageÏóêÏÑú Ï∫êÏãúÎêú manifest Î≥µÏõê ÏãúÎèÑ
            try {
                var cached = localStorage.getItem('__dash_manifest');
                if (cached) {
                    DataLoader.manifest = JSON.parse(cached);
                    manifest = DataLoader.manifest;
                    document.getElementById('fbManifestBtn').classList.add('loaded');
                    document.getElementById('fbManifestBtn').textContent = '‚úÖ Ï∫êÏãú Î°úÎìúÎê®';
                    document.getElementById('fbManifestStatus').textContent = manifest.periods.length + 'Í∞ú Í∏∞Í∞Ñ (Ï∫êÏãú)';
                    document.getElementById('fbDataRow').style.display = 'flex';
                }
            } catch(x) {}
        }
        
        if (!manifest) return;
        
        // 2. Í∏∞Í∞Ñ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ Ï±ÑÏö∞Í∏∞
        DataLoader.populatePeriodSelector();
        
        // 3. ÏµúÏã† Í∏∞Í∞Ñ ÏûêÎèô Î°úÎìú
        var selector = document.getElementById('periodSelector');
        if (selector.options.length > 0) {
            // file:// Î™®Îìú: localStorage Ï∫êÏãúÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î≥µÏõê ÏãúÎèÑ
            if (DataLoader.isLocal) {
                var periodId = selector.value;
                var cacheKey = periodId + '_' + DataLoader.dataType;
                try {
                    var cachedData = localStorage.getItem('__dash_' + cacheKey);
                    if (cachedData) {
                        DataLoader.cache[cacheKey] = JSON.parse(cachedData);
                        document.getElementById('fbDataBtn').classList.add('loaded');
                        document.getElementById('fbDataBtn').textContent = '‚úÖ Ï∫êÏãú Î°úÎìúÎê®';
                        document.getElementById('fbDataStatus').textContent = 'Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© Ï§ë';
                    }
                } catch(x) {}
            }
            await app.changePeriod(selector.value);
        }
        
        // 4. Í∏∞Í∞Ñ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
        selector.addEventListener('change', function() {
            app.changePeriod(this.value);
        });
    });
    </script>
</body>
</html>
